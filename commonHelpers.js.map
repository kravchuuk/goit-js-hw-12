{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport axios from 'axios';\n\nconst refs = {\n  input: document.querySelector('[type=\"text\"]'),\n  searchBtn: document.querySelector('[type=\"submit\"]'),\n  gallery: document.querySelector('.gallery'),\n  loadBtn: document.querySelector('.js-load'),\n  loadDiv: document.querySelector('.js-loader'),\n};\n\nconst params = {\n  API_KEY: '41488002-513c6a9a4c115eae6a99045d3',\n};\naxios.defaults.baseURL = 'https://pixabay.com/api/';\n\nlet currentPage = 1;\nconst per_page = 40;\nlet lightbox = new SimpleLightbox('.gallery a');\nlet galleryItemHeight;\n\nfunction toggleLoader(visible) {\n  refs.loadDiv.innerHTML = visible ? '<span class=\"loader\"></span>' : '';\n  refs.loadBtn.classList.toggle('hidden', !visible);\n}\n\nasync function getGaleryItems(page = currentPage) {\n  try {\n    const response = await axios.get(\n      `?key=${params.API_KEY}&q=${refs.input.value}&image_type=photo&orientation=horizontal&safesearch=true&page=${page}&per_page=${per_page}`\n    );\n\n    return response.data;\n  } catch (error) {\n    console.error(error);\n    iziToast.error({\n      message: 'Oops! Something went wrong. Please try again later.',\n      position: 'topRight',\n    });\n  }\n}\n\nrefs.searchBtn.addEventListener('click', onSearch);\nrefs.loadBtn.addEventListener('click', onClick);\n\nasync function onSearch(e) {\n  e.preventDefault();\n  if (refs.input.value.trim() === '') {\n    iziToast.error({\n      message: 'Sorry, the field must be filled in!',\n      position: 'topRight',\n    });\n    return;\n  }\n\n  currentPage = 1;\n  toggleLoader(true);\n\n  try {\n    const data = await getGaleryItems();\n    refs.gallery.innerHTML = createMarkup(data.hits);\n    lightbox.refresh();\n    if (data.hits.length > 0) {\n      iziToast.info({\n        message: `Total Hits: ${data.totalHits}, Loaded Files: ${data.hits.length}`,\n        position: 'topRight',\n      });\n    }\n    refs.loadBtn.classList.toggle('hidden', per_page >= data.totalHits);\n  } catch (err) {\n    console.error(err);\n  } finally {\n    toggleLoader(false);\n  }\n}\n\nasync function onClick(e) {\n  e.preventDefault();\n  currentPage += 1;\n  toggleLoader(true);\n\n  try {\n    const data = await getGaleryItems(currentPage);\n    refs.gallery.insertAdjacentHTML('beforeend', createMarkup(data.hits));\n    lightbox.refresh();\n\n    iziToast.info({\n      message: `Loaded Files: ${data.hits.length}`,\n      position: 'topRight',\n    });\n\n    if (data.totalHits / per_page <= currentPage) {\n      refs.loadBtn.classList.toggle('hidden', true);\n      refs.loadDiv.innerHTML = '';\n      iziToast.info({\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: 'topRight',\n      });\n    } else if (data.totalHits / per_page >= currentPage) {\n      refs.loadDiv.innerHTML = '';\n      refs.loadBtn.classList.toggle('hidden', false);\n    }\n\n    const galleryItem = document.querySelector('.gallery-item');\n    galleryItemHeight = galleryItem.getBoundingClientRect().height;\n    scrollBy({\n      top: galleryItemHeight * 3,\n      behavior: 'smooth',\n    });\n  } catch (err) {\n    console.error(err);\n  } finally {\n    toggleLoader(false);\n  }\n}\n\nfunction createMarkup(arr) {\n  if (arr.length === 0) {\n    iziToast.error({\n      message:\n        'Sorry, there are no images matching <br> your search query. Please try again!',\n      position: 'topRight',\n    });\n  }\n  return arr\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => {\n        return `\n    <li class='gallery-item'>\n        <a href='${largeImageURL}'>\n            <img src=\"${webformatURL}\" alt=\"${tags}\" data-source=${largeImageURL} class='gallery-img'/>\n        </a>\n        <div class='text-container'>\n            <p>Likes<span>${likes}</span></p>\n            <p>Views<span>${views}</span></p>\n            <p>Comments<span>${comments}</span></p>\n            <p>Downloads<span>${downloads}</span></p>\n        </div>\n    </li>`;\n      }\n    )\n    .join('');\n}\n"],"names":["refs","params","axios","currentPage","per_page","lightbox","SimpleLightbox","galleryItemHeight","toggleLoader","visible","getGaleryItems","page","error","iziToast","onSearch","onClick","e","data","createMarkup","err","arr","webformatURL","largeImageURL","tags","likes","views","comments","downloads"],"mappings":"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"}