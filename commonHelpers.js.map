{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport axios from 'axios';\n\nconst refs = {\n  input: document.querySelector('[type=\"text\"]'),\n  searchBtn: document.querySelector('[type=\"submit\"]'),\n  gallery: document.querySelector('.gallery'),\n  loadBtn: document.querySelector('.js-load'),\n  loadDiv: document.querySelector('.js-loader'),\n};\n\nconst params = {\n  API_KEY: '41488002-513c6a9a4c115eae6a99045d3',\n};\naxios.defaults.baseURL = 'https://pixabay.com/api/';\n\nlet currentPage = 1;\nconst per_page = 40;\nlet lightbox = new SimpleLightbox('.gallery a');\n\nasync function getGaleryItems(page = currentPage) {\n  try {\n    const response = await axios.get(\n      `?key=${params.API_KEY}&q=${refs.input.value}&image_type=photo&orientation=horizontal&safesearch=true&page=${page}&per_page=${per_page}`\n    );\n\n    return response.data;\n  } catch (error) {\n    console.error(error);\n  }\n}\n\nrefs.searchBtn.addEventListener('click', onSearch);\nrefs.loadBtn.addEventListener('click', onClick);\n\nasync function onSearch(e) {\n  e.preventDefault();\n  currentPage = 1;\n\n  if (refs.input.value.trim() === '') {\n    return iziToast.error({\n      message: 'Sorry, the field must be filled in!',\n      position: 'topRight',\n    });\n  } else {\n    refs.gallery.innerHTML = '<span class=\"loader\"></span>';\n  }\n  try {\n    const data = await getGaleryItems();\n    refs.gallery.innerHTML = createMarkup(data.hits);\n    lightbox.refresh();\n    if (data.hits.length > 0) {\n      iziToast.info({\n        message: `Total Hits: ${data.totalHits}, Loaded Files: ${data.hits.length}`,\n        position: 'topRight',\n      });\n    }\n    refs.loadBtn.hidden = per_page >= data.totalHits;\n  } catch (err) {\n    console.error(err);\n  }\n}\n\nasync function onClick(e) {\n  e.preventDefault();\n  currentPage += 1;\n\n  refs.loadDiv.innerHTML = '<span class=\"loader\"></span>';\n  refs.loadBtn.hidden = true;\n\n  try {\n    const data = await getGaleryItems(currentPage);\n    refs.gallery.insertAdjacentHTML('beforeend', createMarkup(data.hits));\n    lightbox.refresh();\n\n    iziToast.info({\n      message: `Loaded Files: ${data.hits.length}`,\n      position: 'topRight',\n    });\n\n    if (data.totalHits / per_page <= currentPage) {\n      refs.loadBtn.hidden = true;\n      refs.loadDiv.innerHTML = '';\n      iziToast.info({\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: 'topRight',\n      });\n    } else if (data.totalHits / per_page >= currentPage) {\n      refs.loadDiv.innerHTML = '';\n      refs.loadBtn.hidden = false;\n    }\n\n    const galleryItem = document.querySelector('.gallery-item');\n    let rect = galleryItem.getBoundingClientRect();\n    scrollBy({\n      top: rect.height * 3,\n      behavior: 'smooth',\n    });\n  } catch (err) {\n    console.error(err);\n  }\n}\n\nfunction createMarkup(arr) {\n  if (arr.length === 0) {\n    iziToast.error({\n      message:\n        'Sorry, there are no images matching <br> your search query. Please try again!',\n      position: 'topRight',\n    });\n  }\n  return arr\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => {\n        return `\n    <li class='gallery-item'>\n        <a href='${largeImageURL}'>\n            <img src=\"${webformatURL}\" alt=\"${tags}\" data-source=${largeImageURL} class='gallery-img'/>\n        </a>\n        <div class='text-container'>\n            <p>Likes<span>${likes}</span></p>\n            <p>Views<span>${views}</span></p>\n            <p>Comments<span>${comments}</span></p>\n            <p>Downloads<span>${downloads}</span></p>\n        </div>\n    </li>`;\n      }\n    )\n    .join('');\n}\n"],"names":["refs","params","axios","currentPage","per_page","lightbox","SimpleLightbox","getGaleryItems","page","error","onSearch","onClick","e","iziToast","data","createMarkup","err","rect","arr","webformatURL","largeImageURL","tags","likes","views","comments","downloads"],"mappings":"owBAMA,MAAMA,EAAO,CACX,MAAO,SAAS,cAAc,eAAe,EAC7C,UAAW,SAAS,cAAc,iBAAiB,EACnD,QAAS,SAAS,cAAc,UAAU,EAC1C,QAAS,SAAS,cAAc,UAAU,EAC1C,QAAS,SAAS,cAAc,YAAY,CAC9C,EAEMC,EAAS,CACb,QAAS,oCACX,EACAC,EAAM,SAAS,QAAU,2BAEzB,IAAIC,EAAc,EAClB,MAAMC,EAAW,GACjB,IAAIC,EAAW,IAAIC,EAAe,YAAY,EAE9C,eAAeC,EAAeC,EAAOL,EAAa,CAChD,GAAI,CAKF,OAJiB,MAAMD,EAAM,IAC3B,QAAQD,EAAO,aAAaD,EAAK,MAAM,sEAAsEQ,cAAiBJ,GACpI,GAEoB,IACjB,OAAQK,EAAP,CACA,QAAQ,MAAMA,CAAK,CACpB,CACH,CAEAT,EAAK,UAAU,iBAAiB,QAASU,CAAQ,EACjDV,EAAK,QAAQ,iBAAiB,QAASW,CAAO,EAE9C,eAAeD,EAASE,EAAG,CAIzB,GAHAA,EAAE,eAAc,EAChBT,EAAc,EAEVH,EAAK,MAAM,MAAM,KAAI,IAAO,GAC9B,OAAOa,EAAS,MAAM,CACpB,QAAS,sCACT,SAAU,UAChB,CAAK,EAEDb,EAAK,QAAQ,UAAY,+BAE3B,GAAI,CACF,MAAMc,EAAO,MAAMP,IACnBP,EAAK,QAAQ,UAAYe,EAAaD,EAAK,IAAI,EAC/CT,EAAS,QAAO,EACZS,EAAK,KAAK,OAAS,GACrBD,EAAS,KAAK,CACZ,QAAS,eAAeC,EAAK,4BAA4BA,EAAK,KAAK,SACnE,SAAU,UAClB,CAAO,EAEHd,EAAK,QAAQ,OAASI,GAAYU,EAAK,SACxC,OAAQE,EAAP,CACA,QAAQ,MAAMA,CAAG,CAClB,CACH,CAEA,eAAeL,EAAQC,EAAG,CACxBA,EAAE,eAAc,EAChBT,GAAe,EAEfH,EAAK,QAAQ,UAAY,+BACzBA,EAAK,QAAQ,OAAS,GAEtB,GAAI,CACF,MAAMc,EAAO,MAAMP,EAAeJ,CAAW,EAC7CH,EAAK,QAAQ,mBAAmB,YAAae,EAAaD,EAAK,IAAI,CAAC,EACpET,EAAS,QAAO,EAEhBQ,EAAS,KAAK,CACZ,QAAS,iBAAiBC,EAAK,KAAK,SACpC,SAAU,UAChB,CAAK,EAEGA,EAAK,UAAYV,GAAYD,GAC/BH,EAAK,QAAQ,OAAS,GACtBA,EAAK,QAAQ,UAAY,GACzBa,EAAS,KAAK,CACZ,QAAS,6DACT,SAAU,UAClB,CAAO,GACQC,EAAK,UAAYV,GAAYD,IACtCH,EAAK,QAAQ,UAAY,GACzBA,EAAK,QAAQ,OAAS,IAIxB,IAAIiB,EADgB,SAAS,cAAc,eAAe,EACnC,wBACvB,SAAS,CACP,IAAKA,EAAK,OAAS,EACnB,SAAU,QAChB,CAAK,CACF,OAAQD,EAAP,CACA,QAAQ,MAAMA,CAAG,CAClB,CACH,CAEA,SAASD,EAAaG,EAAK,CACzB,OAAIA,EAAI,SAAW,GACjBL,EAAS,MAAM,CACb,QACE,gFACF,SAAU,UAChB,CAAK,EAEIK,EACJ,IACC,CAAC,CACC,aAAAC,EACA,cAAAC,EACA,KAAAC,EACA,MAAAC,EACA,MAAAC,EACA,SAAAC,EACA,UAAAC,CACR,IACe;AAAA;AAAA,mBAEIL;AAAA,wBACKD,WAAsBE,kBAAqBD;AAAA;AAAA;AAAA,4BAGvCE;AAAA,4BACAC;AAAA,+BACGC;AAAA,gCACCC;AAAA;AAAA,UAI3B,EACA,KAAK,EAAE,CACZ"}